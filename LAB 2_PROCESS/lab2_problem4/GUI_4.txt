Problem 4: Shared Memory sá»­ dá»¥ng mmap()
Ã tÆ°á»Ÿng thá»±c hiá»‡n
Váº¥n Ä‘á»:

Sá»­ dá»¥ng mmap() Ä‘á»ƒ map má»™t file vÃ o Ä‘á»‹a chá»‰ bá»™ nhá»›
Hai processes cÃ³ thá»ƒ chia sáº» dá»¯ liá»‡u thÃ´ng qua file Ä‘Æ°á»£c map nÃ y
KhÃ¡c vá»›i shared memory (shmget), mmap() map file thá»±c sá»± vÃ o memory

Giáº£i phÃ¡p:

Process Writer: Táº¡o file â†’ mmap â†’ ghi dá»¯ liá»‡u vÃ o memory mapped region
Process Reader: Má»Ÿ file â†’ mmap â†’ Ä‘á»c dá»¯ liá»‡u tá»« memory mapped region
Cáº£ 2 processes truy cáº­p cÃ¹ng má»™t vÃ¹ng nhá»› váº­t lÃ½ thÃ´ng qua file

SÆ¡ Ä‘á»“ hoáº¡t Ä‘á»™ng
File "shared_data.txt"
        â†“
    mmap()
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mapped Memory      â”‚ â† Process Writer (ghi)
â”‚  (Shared Region)    â”‚ â† Process Reader (Ä‘á»c)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Tá»± Ä‘á»™ng sync vá» file


Khi báº¡n ghi vÃ o shared_mem, kernel sáº½ Ä‘Ã¡nh dáº¥u cÃ¡c trang nhá»› lÃ  â€œdirtyâ€

VÃ­ dá»¥ trong chÆ°Æ¡ng trÃ¬nh Writer:

shared_mem->counter = 100;
strcpy(shared_mem->message, "Hello from Writer Process!");


Khi báº¡n gÃ¡n nhÆ° váº­y:

KhÃ´ng cÃ³ lá»‡nh write(fd, ...) nÃ o Ä‘Æ°á»£c gá»i cáº£.

NhÆ°ng kernel biáº¿t ráº±ng: â€œTrang bá»™ nhá»› áº£o tÆ°Æ¡ng á»©ng vá»›i file nÃ y Ä‘Ã£ bá»‹ thay Ä‘á»•i.â€

Kernel sáº½ ghi láº¡i (flush) cÃ¡c trang bá»‹ thay Ä‘á»•i xuá»‘ng Ä‘Ä©a (file thá»±c) theo cÆ¡ cháº¿ cá»§a mmap().

ğŸ§© 5. TÃ³m láº¡i
File shared_data.txt cÃ³ ná»™i dung: VÃ¬ mmap() Ã¡nh xáº¡ bá»™ nhá»› vÃ o file tháº­t, vÃ  kernel ghi dá»¯ liá»‡u tá»« bá»™ nhá»› ra file.
KhÃ´ng cáº§n write() hay fwrite(): VÃ¬ mmap() thay tháº¿ hoÃ n toÃ n thao tÃ¡c ghi/Ä‘á»c qua file descriptor.
Ná»™i dung file cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c (hoáº·c lá»™n xá»™n): VÃ¬ chá»©a dá»¯ liá»‡u nhá»‹ phÃ¢n cá»§a struct SharedData, khÃ´ng pháº£i vÄƒn báº£n thuáº§n.




cd LAB2
CD lab2_problem4
nano shared_data.h
nano mmap_writer.c
nano mmap_reader.c
nano mmap_multi_reader.c
nano Makefile 

make clean
make all


Test cÆ¡ báº£n (1 Writer + 1 Reader):
Terminal 1 - Writer:
./mmap_writer
Terminal 2 - Reader:
./mmap_reader



Test cÆ¡ báº£n (1 Writer + 1 Reader):
Terminal 1 - Writer:
./mmap_writer
Terminal 2 - Reader:
./mmap_reader




## **Káº¿t quáº£ mong Ä‘á»£i**

### **Writer Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     MMAP Writer - Writing Data       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[âœ“] File 'shared_data.txt' created/opened successfully
[âœ“] File size set to 4096 bytes
[âœ“] Memory mapped at address: 0x7f8a3c000000

Writing data to shared memory...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Counter: 100
Message: Hello from Writer Process!
Data array: 0 10 20 30 40 50 60 70 80 90 
Values array: 3.14 6.28 9.42 12.56 15.70 
Status: READY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[âœ“] Data written successfully!
[INFO] Keeping memory mapped for 30 seconds...
[INFO] Run './mmap_reader' in another terminal now!

Time remaining: 30 seconds
```

### **Reader Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     MMAP Reader - Reading Data       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[âœ“] File 'shared_data.txt' found!
[âœ“] File opened successfully
[âœ“] Memory mapped at address: 0x7f8a3c000000

Reading data from shared memory...
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

>>> Round 1 <
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Counter: 100
Message: Hello from Writer Process!
Data array: 0 10 20 30 40 50 60 70 80 90 
Values array: 3.14 6.28 9.42 12.56 15.70 
Status: READY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Waiting 10 seconds before next read...

>>> Round 2 <
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Counter: 200
Message: Updated message!
Data array: 0 10 20 30 40 50 60 70 80 90 
Values array: 3.14 6.28 9.42 12.56 15.70 
Status: UPDATED




void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);
```

- **addr = NULL**: Äá»ƒ kernel tá»± chá»n Ä‘á»‹a chá»‰
- **length = SHARED_SIZE**: KÃ­ch thÆ°á»›c vÃ¹ng map
- **prot = PROT_READ | PROT_WRITE**: Quyá»n Ä‘á»c vÃ  ghi
- **flags = MAP_SHARED**: Chia sáº» vá»›i processes khÃ¡c (quan trá»ng!)
- **fd**: File descriptor cá»§a file Ä‘Ã£ má»Ÿ
- **offset = 0**: Báº¯t Ä‘áº§u tá»« Ä‘áº§u file

### **2. So sÃ¡nh MAP_SHARED vs MAP_PRIVATE:**

| Äáº·c Ä‘iá»ƒm | MAP_SHARED | MAP_PRIVATE |
|----------|------------|-------------|
| Chia sáº» vá»›i processes khÃ¡c | âœ… CÃ³ | âŒ KhÃ´ng |
| Thay Ä‘á»•i ghi vÃ o file | âœ… CÃ³ | âŒ KhÃ´ng |
| Use case | IPC, shared data | Copy-on-write |

### **3. Luá»“ng hoáº¡t Ä‘á»™ng:**
```
1. Writer: open() â†’ ftruncate() â†’ mmap() â†’ write data â†’ wait
2. Reader: open() â†’ mmap() â†’ read data â†’ munmap()
3. Writer: munmap() â†’ close()
